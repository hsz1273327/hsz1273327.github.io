---
layout: post
title: "TLS与通信安全"
date: 2020-12-02
author: "Hsz"
category: introduce
tags:
    - DataSecurity
header-img: "img/home-bg-o.jpg"
update: 2020-12-02
---
# TLS与通信安全

互联网的通信安全是建立在SSL/TLS协议之上.

<!--more-->

## 从明文通信到TLS加密通信

在TLS出现之前的蛮荒时代,数据都是明文传输的,明文传输的缺点当然就很明显--消息在每个经过的节点上都可以被读出窃取到.因此早期qq经常会有盗号的,那就是明文传输的锅.

![明文通信][1]

总结来说明文传输的风险点有3个:

1. 窃听风险(eavesdropping):第三方可以获知通信内容

2. 篡改风险(tampering):第三方可以修改通信内容

3. 冒充风险(pretending):第三方可以冒充他人身份参与通信

那很容易的我们会想到给数据加密,如果是对称加密,那么只要在客户端获得密码,那就相当于没有加密了,因此肯定不行.一般来说安全起见都是使用的非对称加密的方式,即客户端公钥加密,服务端私钥解密.因此我们可以在每次建立连接时先请求服务端的公钥,拿到公钥后对负载数据加密,服务端收到负载后解密获得数据.

这个方法有两个缺陷

1. 非对称加密慢,会影响通信效率
2. 无法保证公钥可信

针对第一个缺陷,我们可以使用对称加密的方式,在获取到公钥后向服务器申请对称加密的密码,这个密码只在当次会话中有效,这样就不会影响通信效率了,而且即便是对称加密的密码被窃取了它也只会影响一次会话.

针对第二个缺陷,我们就只能借助第三方机构通过签发证书的方式保证公钥可信了.于是我们得到了如下的请求流程

![TLS流程][2]

这就是TLS的基本流程了,也就是

1. 客户端向服务器端索要并验证公钥
2. 双方协商生成"对话密钥"
3. 双方采用"对话密钥"进行加密通信

当然上面的整个过程都是忽略细节的.细节可以写本叫[HTTPS权威指南：在服务器和Web应用上部署SSL/TLS和PKI](https://www.ituring.com.cn/book/1734)或者[图解密码技术](https://www.ituring.com.cn/book/1737)的书

## TLS解决的安全问题

TLS主要解决的问题可以归结为3点:

1. 第三方无法窃听,因为所有信息都是加密传播
2. 双方可以立即发现通信是否被篡改,因为TLS具有校验机制
3. 身份无法冒充,因为配备身份证书.

但是依然没有银弹,TLS只是可以解决大部分问题,而没办法解决所有问题,同时也会带来新的问题:

1. TLS本身无法确定证书是否可信,如果你信任了不可信的证书,那风险就只有自己担了.
2. TLS会降低通信效率,毕竟多了加密和多次请求.

因此使用需要权衡.但是在多数情况下是推荐使用的.

TLS目前已经广泛应用于HTTP协议,SMTP协议,GRPC协议等应用层协议之上,就如本文开头说的一样,成为了通信安全的基石.

## 证书

TLS协议有一步非常关键的是由可信第三方给客户端发送包含服务器公钥信息的证书.这一步直接决定了后面每一步的安全性.

那么怎么证明证书可靠呢?

答案就是人工看.

我们可以打开chrome,在`设置->安全->管理证书`位置找到你在各个https站点获得的证书.随便点一个进去看看

![证书][3]

一个证书至少会有签发人,签发对象,到期时间和公钥这4个信息.上面这个证书的详情页就可以查看到各种证书信息.我们看这些信息是否和访问的服务相符,有没有过期,签发人是否可信,就可以判断证书是否可信了.

### 获得证书

如何获得这个证书以及其对应的公私钥对呢?

有如下几种方法

### 找你的域名服务商,在它的平台上购买域名对应的证书

可以使用这种方式的前提是你得先有一个域名,而且这个域名得是从域名服务商那边买来的.这种方式应该是最安全最省事的,就是可能会要钱.当然也有不要钱的.以阿里为例

![阿里申请证书位置][4]

进入后按下图配置

![阿里免费证书][5]

之后进入付款步骤一路付款即可(反正也是0元)

在购买好证书后我们需要做配置,进入SSL证书控制台后会我们可以看到有可以申请签发的证书,这个时候只需要点击进入,按提示的填入域名即可(域名需要是已经解析过的域名)

![填写申请][6]

全部填好后会需要等待验证.

![等待验证][7]

### 使用


[1]: {{site.url}}/img/in-post/TLS_HTTPS/明文通信.jpg
[2]: {{site.url}}/img/in-post/TLS_HTTPS/TLS流程.jpg
[3]: {{site.url}}/img/in-post/TLS_HTTPS/证书.PNG
[4]: {{site.url}}/img/in-post/TLS_HTTPS/阿里ssl证书申请位置.png
[5]: {{site.url}}/img/in-post/TLS_HTTPS/阿里免费证书.png
[6]: {{site.url}}/img/in-post/TLS_HTTPS/填写申请.png
[7]: {{site.url}}/img/in-post/TLS_HTTPS/等待验证.png