---
layout: post
title: "用deskmini和8700g组一台AIPC"
series:
    aipc_experiment:
        index: 2
date: 2024-11-27
author: "Hsz"
category: experiment
tags:
    - Linux
    - AIPC
    - Rocm
header-img: "img/home-bg-o.jpg"
update: 2024-11-27
---
# 用deskmini和8700g组一台AIPC

我在2024年8月就入手了[华擎的deskmini x600准系统](https://www.asrock.com/nettop/AMD/DeskMini%20X600%20Series/index.cn.asp).基于它配合[8700g](https://blog.hszofficial.site/experiment/2024/11/08/aipc%E6%8A%98%E8%85%BE%E8%AE%B0/#amd-ryzen-7-8700g)我会组一台APIC带到单位作为办公机使用替换我装了黑苹果的nuc8.

计划这个机器的生命周期为3年,在这三年中它会被用来:

+ 平时工作.主要是编程,写markdown,打docker镜像,浏览网页.基本不关机
+ 轻度娱乐.带回家可以打打游戏.
+ 学习研究,主要是研究rocm和npu在ai方面的使用情况.为后续家用服务aipc项目做技术储备,当然也会额外学些别的比如blender,godot什么的.

本文仅介绍这台机器的配置思路和基本环境搭建过程

## 准系统规格

它是deskmini x300准系统对应AM5接口CPU的升级款.

它可以分为4个部分:

+ 一个标准stx规格主板
+ 一个1.9L机箱
+ 一个120w的19v/2.5/5.0电源适配器
+ 一个标称解热65w铝制cpu散热器

当然了电源适配器和cpu散热器基本可以认为是添头,主要部分还是主板和机箱

### 主板规格

主板就很有特点,不常见的stx规格,和上一代x300的前后置io没有变化.使用19v的2.5/5电源适配器供电,内存规则则是ddr5的笔记本内存.总的来说规格如下:

+ 供电: 6+2相供电,一般认为最大可以带220W板载功率,我查了下市面上符合19v/2.5/5.0这一规格的电源适配器最高也就200w,所以说供电也算绰绰有余.
+ CPU: 一个AMD的AM5接口,支持最大tdp65W的zen4/zen5带核显的cpu,据说有人用7800x3d这类tdp超过65w的U好像也能正常运行.
+ 内存: 两个SO-DIMM DDR5插槽,支持最高6400+MHz,最大96GB容量的笔记本DDR5内存,支持xmp和expo
+ 存储:
    + 两个sata2.5寸硬盘接口,需要使用专用转接线引出标准sata口和对应供电
    + 一个pcie 5.0x4的m.2固态硬盘(正面),
    + 一个pcie 4.0x4的m.2固态硬盘(背面)
+ 网络: 
    + 后面板有一个RJ-45 LAN网口(2.5G)
    + 主板正面m2下方有一个M.2 Key-E无线网卡接口,我买的是带wifi配件的版本,给了一个wifi6网卡.
+ 视频输入输出:
    + 后io面板一个dp1.4接口(4K@120Hz)
    + 后io面板一个hdmi接口(4K@120Hz)
    + 后io面板一个D-Sub接口(1080p@60Hz)
+ 音频输入输出:
    + 前置IO一个3.5mm耳机孔
    + 前置IO一个3.5mm音频输入孔
+ USB:
    + 前置IO一个USB 3.2 Gen1的Type-A接口
    + 前置IO一个USB 3.2 Gen1的Type-C接口
    + 后置IO两个USB 3.2 Gen1的Type-A接口

+ 板上额外接口
    + 正面右上角1个USB 2.0的9pin接针
    + 正面右上角USB 2.0的9pin接针边1个2pin的清cmos接针
    + 正面底部左下角两个4pin的pwm风扇接针
    + 正面右下角一个开机的9pin接针
    + 正面右下角开机9pin边一个4pin的音源接针
    + 背面底部两个特制sata中间一个4pin(ph2.0 4P)的内置音响接口

### 机箱规格

deskmini配置的是一个1.9L机箱,真就是巴掌大,使用抽拉式结构,拧开后面4颗螺丝后直接拉主板支架就出来了,还是相当方便的.主板支架也是使用4颗螺丝固定,不过主板的io面板不是一体式的,看起来是真的很丐.

首先是主板支架,主板支架部分包括了机箱背面面板和主板支撑板,背面面板上提供了3个6mm天线孔和一个db9孔位,默认是由铁皮盖着的,可以拿螺丝刀敲掉.支撑板正面是四个螺柱用于支撑主板,背面则是一个2.5寸硬盘支架,支持放最多两块2.5寸硬盘.同时支撑板是有镂空的,我们可以比较轻松的穿线.

然后是外壳,外壳由一个滑槽将机箱内部分成了两个部分,小的那个部分(右侧)是sata硬盘的空间,如果不装那就是空着的.右侧面板提供了安装7.5x7.5标准VESA支架的接口;
大的是主板的空间(左侧),主板空间支持小于等于47mm的下压式散热器,左侧面板提供了两个usb type-A孔位,可以掰掉挡板使用. 整个外壳部分只有顶部和左侧面板有镂空可以作为进出风口.

### 特点总结

这个准系统最大的卖点就是小.可以换am5接口桌面端CPU的准系统似乎目前只有它,而且它只有1.9L放哪里都不占地方,除了nuc办公系列外很多成品mini主机并不会比它小多少.你可以理解为这是一个可以diymini主机的平台,而且这个平台至少可以折腾到2027年am5接口退役.

这个机箱的最大缺陷其实就是散热,作为一个小机箱它肯定不存在风道,但由于没有提供风扇安装位,整个机箱的散热相当于只能靠CPU下压散热器吹进来那点风,而热风无法被快速排出必然容易造成箱内积热,更加严重的问题是内存条所在的位置几乎是完全封闭的,因此整个机器在重负载下最热的部分是内存.

这一代的deskmini确实属于没有用心设计,在不改变机箱主板尺寸的条件下可以做的改进有如下几点:

+ 前置type-c口如果可以改为usb4或者类似[技嘉B650E-AORUS-ELITE-X-AX-ICE](https://www.gigabyte.com/Motherboard/B650E-AORUS-ELITE-X-AX-ICE/sp#sp)这样直连cpu,这样不同的CPU可以有不同的速率.
+ 可以考虑底部和前面板做镂空,甚至可以考虑在前面板和顶部预留外置风扇的孔位
+ 可以考虑把后置的USB,网线口往上移动,现在会挡着内存散热

## 额外改造

改造部分大致按改进的项目分如下几种

### 更换电源

必要性: 3/5
难度: 0/5
成本: 300元以下

准系统支持19v/2.5/5标准的适配器.官方给的原配120w电源其实很中庸,适配器不算大,但也不小,120w基本什么U都能带,但官方性能模式要求180w又达不到.要换电源推荐氮化镓电源适配器,确实小.淘宝搜`氮化镓电源`就可以找到,注意看有没有3c认证.

换电源改进的其实就两个目标

1. 获得更大的功率
2. 获得更小的体积


根据使用场景的不同有两种思路:

1. 低功耗用法场景,配置低功耗U,基本不超频.这种场景下换90w的氮化镓就够了,长宽和一个普通手机充电头差不太多,只是高度会高些,可以让供电极致紧凑.
2. 极致性能场景,配置R7处理器而且超频.这种场景下换200w的氮化镓,适配器大小和macbook的适配器差不多,也不算特别大,但200w配个超频的R7足够充分发挥这个准系统的能力了

### 增加usb接口

必要性: 4/5
难度: 2/5
成本: 40元

准系统前后加起来就4个usb口,其中一个还是type-c,这就有点尴尬了,如果你用有线键盘鼠标,那相当于只剩一个type-c和一个type-a可用了,要是还要接个摄像头啥的那就只有type-c能用了,usb口确实捉襟见肘.

好在淘宝有x300的usb扩展可以和这一代通用,淘宝搜`deskmini usb扩展`就可以找到,似乎也就一家在卖,用法很简单.

1. 左侧面板的usb开口拿螺丝刀敲掉
2. 扩展板接好延长线
3. 将扩展板拿螺丝安装到左侧面板
4. 将延长线另一端插在主板的USB 9pin插针上即可

### 增加clean cmos按钮

必要性: 4/5
难度: 3/5
成本: 零件凑凑不会超过10元

`clean cmos`在这块主板上可以通过短接2pin的`clean cmos`针脚实现.短接最简单的办法就是拿个一字螺丝刀碰在上面个10s.但对于调试bios来说这种操作相当于每次要清coms就得拆机,这就过于麻烦了.
好在机箱上天线位置给了3个开口,我们可以充分利用中间的开口,做个按钮来实现`clean cmos`按键.这个位置的一个好处是天线天然有厚度,只能手指伸到中间才能按到这个按钮,没那么容易误触(家里有小孩的手贱乱按那就没办法了).

这个的制作需要一点DIY技术.我们会用到

1. 两根母对母的20cm杜邦线,
2. 绝缘热缩管/热熔胶
3. 按钮外部7mm以上,内部6mm以下的按钮都行,有小的就买小的,我卖的是DS-402无锁自复位微型按钮,为了和天线融为一体买的黑色
4. 电烙铁,焊锡丝,加固用的,没有也不是不能做
5. 尖嘴钳

简单来说就是如下步骤:

1. 两根杜邦线都拆掉一头的塑料部分
2. 让金属部分裸露出来分别插入按钮的两个引脚(不用管顺序),然后压实金属部分,有条件就焊接一下,注意千万别让两个引脚短接上,这边有条件可以拿个led小灯试一下按钮按下能不能点亮来测试是否安装到位.
3. 用绝缘热缩管或热熔胶保护下引脚部分防止裸露的金属碰到一起或碰到别的电路.这样按钮部分就做好了
4. 敲掉中间的wifi天线位置的铁挡板,用尖嘴钳将按钮装在中间的wifi天线位置上,注意垫片应该放在内侧
5. 按钮的两根杜邦线分别插在2pin的两个针脚上这样就完成了.

我的这个实现对于使用传统wifi天线或者小辣椒天线的可行,对于用那种mini天线的因为mini天线直径很大所以可能就没法安装了,而对于使用内置软板天线的这个方案会增加误触概率,也就不推荐了

### 增加oculink接口

必要性: 1/5
难度: 2/5
成本: 视显卡坞而定,如果有闲置的atx电源(450w以上)400元左右,没有则大概800元左右

oculink相当于是一个pcie 4.0x4,市面上有不少现成的m.2口转oculink的方案,外接一个显卡坞我们就可以得到一个外置的pcie 4.0x4的 pcie x16接口了.
这个操作在deskmini这台小机器上有点大炮打蚊子的感觉,但对于`折腾`来说似乎又是不可或缺的一环,反正我是装了.

这个的安装难度其实很低

1. 买个20cm的m.2口转oculink转接卡,插在主板背面的m2槽里
2. 线从主板底部穿出,绕到正面,敲掉db9的铁挡板,拧上螺丝,
3. 压一压接口附近线材让线材尽量扁,然后装回主板即可


<!-- ### 内置音响

必要性: 1/5
难度: 3/5 -->

### 增加外置屏幕

必要性: 1/5
难度: 1/5
成本: 转接架30元,便携屏一般千元内

这边所谓的外置屏幕指的是用VESA支架挂一块便携屏,让deskmin成为这块屏幕的底座.deskmini的专用VESA支架淘宝有卖,搜`deskmini 壁挂转接架`就能找到.但主要的难点在于找块合适的便携屏.

为什么必须是便携屏?因为普通屏幕太重,deskmin作为底座中心会向前偏移从而倾倒,同理即便是便携屏也不能弄太大太重的,否则会有一样的问题.我找到的是雕塑家的一款16寸的便携屏,它带两个75mm的VESA支架孔刚好可以安装,装好后重心同样也会前倾,但你不碰它它不会倒.

如果希望这个配置重心稳一些,可以在外面挂一个磁吸的1225/1425风扇,增加散热的同时也可以多少把重心往后往下拉一拉.

### 改进散热

必要性: 3/5
难度: 1~5/5

散热是deskmini最大的软肋,官方给的散热标称只能解热65w,这个散热器面对低功耗U或者不超频的U还是够的,但如果你要上200w电源要超频那是妥妥的不够.

要改进散热我们可以按难度分步实现,根据难度不同我分成如下几步:

#### 换CPU散热器

难度: 1/5
成本: 400元以下
必要性: 高

准系统支持最大47mm高度的散热器,这个规格下公认的最强王者是利民的apx 90-47 全铜版,但是性能只比普通版好一点点但巨重而且贵很多要250元左右所以其实挺不划算的,完全可以用普通版平替,虽然我用的就是这款全铜的,但我主要是为了让主机重点好压重心.

需要注意这款散热器安装需要对主板和机箱略微做一点操作

1. 用螺丝刀松一松mos管上散热鳍片的固定螺丝,然后将散热鳍片向外推到顶,再紧好固定螺丝.这个操作是为了避免和这款散热器有干涉
2. 更换猫头鹰的9214风扇(125元),这样可以避免风扇卡扣增加的1mm让散热器刚好进不去机箱,顺便优化下散热器的噪音问题
3. 拆下机箱上固定左侧面板中间部分的两颗螺丝,这样让我们可以稍微掰大一点主板入口,这样可以比较容易的把主板支架塞进去.

#### 增加内存散热马甲

难度: 0/5
成本: 120/190元
必要性: 中

前面说了这个准系统散热最大的问题其实是内存位置积热,我们可以淘一个内存散热马甲让内存热量尽量让热量出来快些.可以咸鱼上找人定制,我是在`小核桃当饭吃`这个咸鱼卖家那边定的,铝的120元可以上色,铜的188元不能上色.

当然了这个需要配合风道才能有效果,否则不过是增加重量而已.

#### 改进风道

难度: 0/5
成本: 0元
必要性: 高

deskmini这种小主机其实谈不上风道,都是下压散热器进风,外面的冷空气通过散热器的鳍片被加热压到主板上然后向四周吹开带动周边空气流动.流动的空气被挤压从其他孔洞中排出机箱.
但其实这里有一个问题--由于散热器风扇和进风口并不是贴合的,机箱内的热空气可以继续被风扇吹回鳍片,这就会大大降低散热效率,我们其实要改进的就是这个进风的风道.

解决这个问题的方法丑陋又简单--给进风的风扇顶部用电工胶带裹上几圈,让他增高个2mm,然后塞进机箱,由于胶带是软的所以散热器肯定能塞进去,而塞进去的同时胶带又贴着机箱壁,这样就形成了独立的进风风道,保证了吹到鳍片上的都是冷风.

#### 引出系统风扇4pin

难度: 2/5
成本: 10元以下
必要性: 对低负载用方法低,对高负载用法高

既然有那么多地方有足够大的孔位i,我们完全可以把系统风扇的4pin线引出来方便外接风扇.这个操作的难点在于没办法固定端子,端子是塑料的,要能插进去需要用力压,能吃得住这个力的固定方式靠胶布粘肯定不行.
我想到的方式是结合oculink接口,在一个db9开口中同时安装oculink和4pin端子,用热熔胶黏住4pin端子的底部和oculink接口的金属面,4pin端子会有一个凸起卡在db9口的边缘,利用这个边缘吃力.

那需要的就是买根10cm的4pin风扇延长线然后用胶粘上就行了

##### 外接风扇

在引出了系统风扇4pin端子的前提下外接风扇就简单了.但一定要注意,外接风扇一定会影响噪音,风扇越小转速就越高,噪音就越大.

外接风扇有两个思路,一个是增加出风风扇,一个是增加进风风扇.

> 增加出风风扇

难度: 0/5
成本: 看风扇,如果全上猫头鹰也得小250
必要性: 低

对于deskmini,我们可以理解为在机箱顶部是官方认定的出风口,可以放置排风风扇,放3个4025风扇或者2个6025风扇都可以.由于在顶上也不用怎么固定,放上去就行,主要是要注意方向别弄成进风了

缺陷是

1. 离积热最严重的底部太远因此并不能解决内存积热问题
2. 这种小尺寸风扇普遍转速高噪音大.

> 增加进风风扇

难度: 1/5
成本: 固定部件10元,其他看风扇看配件,风扇如果上猫头鹰也得200,300元,普通保护网1元一个,猫头鹰的一个50元左右
必要性: 对低负载用方法低,对高负载用法高

机箱的进风口基本就是一个12cm边长的方形区域,外挂一个12025风扇刚刚好,主要是怎么固定的问题.机箱上并没有给出风扇的安装孔位,如果要装,个人会比较建议用磁吸固定.
和散热器风扇一样,如果希望效率最大化,也可以用电工胶带裹一圈防止漏风出来.

增加进风风扇主要是

1. 想靠力大砖飞强行靠风压尽量多的压出机箱内热气
2. 增加机箱内的冷空气提高热交换效率

12025这样的大风扇通常不用很高的转速,因此噪音低这个方案会相对更靠谱些.
但由于内存是横在底部的,也就是说这个方案可以改善靠近cpu那根内存一直吃cpu尾气积热的问题,但最底下那根由于被上面一根内存挡着完全吹不到风所以该积热还是积热.

但相对于上面增加出风风扇的方案,这个方案可能更有用一点

#### 增加出风口

难度: 5/5
成本: 视是否挂风扇成本会有较大变化
必要性: 对低负载用方法低,对高负载用法高

增加出风口主要是针对内存散热.deskmini的内存位置一面吃cpu尾气,剩下的每一面都没有专门开孔,即便是io面板也被两个USB和网口档的死死的.
那么要想解决这个积热问题,可能比较靠谱的就是给机箱的内存位置开开孔.开孔位置有3个:

1. 前面板底部.这里算是比较容易开孔的位置.deskmini的前面板是一块有网孔的铁片上叠了一块塑料板.对应内存的位置刚好是前置io的面板位置我们还是有机会放一块4010风扇上去的.
    这个位置比较尴尬的是铁片并不平整,而是有个用于理线的弯,这样内置风扇可能就比较难了.但无论如何这一位置由于材质是塑料,已经是最好操作的位置了.
2. 左侧面板底部.相当于在原本12cm宽的网孔下面再开个2cm,这样风扇往下移两厘米就可以吹到内存,这个方案的缺点是我们要在铁皮上打孔,如何在铁皮上打孔而不会让铁皮受压变形这个就比较考验技术了.
3. 机箱底部.底部也是铁片,所以开孔难度也相当大,但由于内存横在cpu和底部之间,其实即便开孔也对散热很难有效果.如果一定要开孔,可能换个高垫脚上,补两个4025风扇向上吹风可以对散热有所改善

### 防尘

防尘说白了就是把开口用防尘网都堵上,防尘会在一定程度上影响散热,因此并不是非做不可,一般我们只需要做进风口的防尘就可以了,对于这种下压风道来说就是在下压散热器位置贴块防尘网.
讲究点的顶部为了防止落灰也弄块防尘网就行了.像deskmin这种铁皮箱子.贴防尘网只要用那种很薄的磁贴就行.

唯一需要注意的是防尘网贴在内部还是外部.防尘网一般都是有伸缩性的,风吹久了就会松松垮垮,为了避免这种情况,最好是让风吹的防尘网贴到铁框上,也就是说进风口的防尘网应该贴在机箱外侧,出风口则应该贴在内侧.

## 最终搭配配置

对于组apic用于办公学习这个需求,我自然是按高负载方向进行配置的.deskmini的配置核心就是除了cpu和内存外都尽量选低功耗低发热的设备.

我为这套搭配的最终配置如下:

+ CPU: 8700g
+ 内存: 英睿达48gx2 标称xmp5600MHZ的的笔记本内存
+ 固态硬盘: 铠侠sd10 2T
+ wifi网卡: 官方的Intel® Wi-Fi Kit,提供蓝牙和wifi6的支持

除此之外还额外扩展了

+ 氮化镓200w 19v 2.5/5.0接口适配器替代原装电源适配器
+ 利民apx90 x45纯铜版散热器用于替代原装散热器,猫头鹰9214黑款风扇用于替换上面散热器的风扇
+ 一对铝制内存散热装甲
+ 第三方的DeskMini USB 2.0 排线,用于充分利用板载USB 2.0 接针以额外提供2个usb2.0接口
+ 自制clear cmos按钮
+ 一个12cm的防尘网放在进风口
+ 一块带7.5VESA接口的1080p@120hz的便携屏幕,通过官方提供的7.5x7.5标准VESA支架挂在机箱上
+ 一个oculink接口,由后置的pcie 4.0x4的m.2接口转换得到


## BIOS设置和超频调优

主板BIOS目前(截止到2024年11月30日)更新到4.03版本,支持了AMD AGESA 1.2.0.0.我目前已经刷到了最新版本.

至于BIOS设置,主要是如下几块

+ CPU超频,
    + 开pob
    + 温度墙
    + 负压

+ IGPU超频
    + gfx定频:3300
+ 内存超频
    + 开启xmp
    + 手动超频到6000
+ 风扇策略
    + 设置风扇转速曲线节点为(),(),(),()

最终性能效果如图,以下是在win10下侧测试数据:

![cpuz][1]
![memory][2]
![disk][3]
![cinebenchr23][4]
![timespy][5]

## 系统及环境安装

要用rocm,还要长时间不关机,自然得用linux系统.我使用的[Ubuntu 24.04.1](https://ubuntu.com/download/desktop/thank-you?version=24.04.1&architecture=amd64&lts=true),刷好usb安装盘后插上安装即可.在安装好后我又进行了如下几个步骤来设置使用环境

### 更新系统
### 安装驱动和rocm
### 美化系统
### 美化terminal
### 安装监控工具
### 安装常用软件
### 安装docker
### 安装常用开发环境
### 安装游戏

 
## 后续


[1]: {{site.url}}/img/in-post/deskminiaipc/cpuz.jpg
[2]: {{site.url}}/img/in-post/deskminiaipc/memory.jpg
[3]: {{site.url}}/img/in-post/deskminiaipc/disk.jpg
[4]: {{site.url}}/img/in-post/deskminiaipc/cinebenchr23.jpg
[5]: {{site.url}}/img/in-post/deskminiaipc/timespy.jpg